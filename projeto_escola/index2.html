<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verificação Facial - Futurista</title>
  <style>
    /* ======== ESTILO FUTURISTA E JOVEM ======== */
    :root {
      --cor-primaria: #00ffff;
      --cor-secundaria: #0077ff;
      --cor-fundo: #02040a;
      --cor-brilho: #0ff;
    }

    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(circle at top left, #001020, #000000 70%);
      background-attachment: fixed;
      color: #fff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      animation: fundo-pulso 6s infinite alternate;
    }

    @keyframes fundo-pulso {
      0% { background: radial-gradient(circle at top left, #001020, #000000 70%); }
      100% { background: radial-gradient(circle at bottom right, #001830, #000000 70%); }
    }

    .card {
      width: 90%;
      max-width: 780px;
      background: rgba(0, 10, 20, 0.8);
      border: 2px solid rgba(0, 255, 255, 0.25);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.25);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      backdrop-filter: blur(8px);
      transition: 0.4s;
    }

    .card:hover {
      box-shadow: 0 0 45px rgba(0, 255, 255, 0.45);
      border-color: rgba(0, 255, 255, 0.4);
      transform: scale(1.02);
    }

    h2 {
      font-size: 1.8em;
      color: var(--cor-primaria);
      text-shadow: 0 0 10px var(--cor-brilho);
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    p {
      font-size: 0.9em;
      color: #aeeaff;
    }

    video, canvas {
      border-radius: 10px;
      background: #050c16;
      max-width: 100%;
      border: 1px solid rgba(0, 255, 255, 0.3);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }

    .col {
      flex: 1 1 240px;
      min-width: 240px;
      max-width: 320px;
    }

    button {
      padding: 12px 18px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Orbitron', sans-serif;
      text-transform: uppercase;
      transition: all 0.3s;
      letter-spacing: 1px;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--cor-secundaria), var(--cor-primaria));
      color: #000;
      box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
    }

    .btn-primary:hover {
      box-shadow: 0 0 24px rgba(0, 255, 255, 0.8);
      transform: scale(1.05);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--cor-primaria);
      color: var(--cor-primaria);
    }

    .btn-ghost:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 12px rgba(0, 255, 255, 0.3);
    }

    label {
      color: var(--cor-primaria);
      font-size: 14px;
      text-align: left;
      margin-bottom: 6px;
      display: block;
    }

    input[type=range] {
      width: 100%;
      accent-color: var(--cor-primaria);
    }

    small {
      display: block;
      margin-top: 6px;
      color: #8ae9ff;
      font-size: 0.8em;
    }

    .msg {
      margin-top: 20px;
      min-height: 24px;
      font-weight: 600;
      text-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
      color: var(--cor-primaria);
      letter-spacing: 1px;
    }

    /* Animação de brilho nos botões */
    @keyframes neon {
      0%, 100% { box-shadow: 0 0 10px var(--cor-primaria); }
      50% { box-shadow: 0 0 25px var(--cor-primaria); }
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Verificação Facial</h2>
    <p>Ative a câmera, capture seu rosto e valide sua identidade. Sistema de verificação prototípico de segurança avançada.</p>

    <div class="row">
      <div class="col">
        <label>Vídeo da câmera</label>
        <video id="video" autoplay playsinline width="320" height="240"></video>
        <small>Permita acesso à câmera.</small>
      </div>

      <div class="col">
        <label>Foto capturada</label>
        <canvas id="preview" width="320" height="240"></canvas>
        <small>Visualização da imagem atual.</small>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <button id="btnStart" class="btn-primary">Abrir câmera</button>
      <button id="btnCapture" class="btn-primary">Capturar</button>
      <button id="btnRegister" class="btn-ghost">Registrar rosto</button>
      <button id="btnVerify" class="btn-primary">Verificar</button>
      <button id="btnClear" class="btn-ghost">Limpar</button>
    </div>

    <div style="margin-top:10px; text-align:left; max-width:600px; margin-inline:auto;">
      <label>Limiar de aceitação</label>
      <input id="thresh" type="range" min="100" max="5000" value="1200" />
      <small>Valor atual: <span id="threshVal">1200</span></small>
    </div>

    <div class="msg" id="msg">Referência: <span id="refStatus">nenhuma</span></div>
    <small>⚠️ Este é um protótipo local. Em produção, use um serviço de verificação facial profissional.</small>
  </div>

  <script>
    // mesmo JavaScript do seu código anterior
    const video=document.getElementById("video"),preview=document.getElementById("preview"),ctx=preview.getContext("2d"),btnStart=document.getElementById("btnStart"),btnCapture=document.getElementById("btnCapture"),btnRegister=document.getElementById("btnRegister"),btnVerify=document.getElementById("btnVerify"),btnClear=document.getElementById("btnClear"),msg=document.getElementById("msg"),refStatus=document.getElementById("refStatus"),threshInput=document.getElementById("thresh"),threshVal=document.getElementById("threshVal");let stream=null;const REF_KEY="face_reference_img_v1",SMALL_W=64,SMALL_H=64;function updateRefStatus(){const e=localStorage.getItem(REF_KEY);refStatus.innerText=e?"salva":"nenhuma"}function showMessage(e,t="transparent"){msg.innerText=e,msg.style.background=t,msg.style.color="#fff"}updateRefStatus(),threshInput.addEventListener("input",()=>{threshVal.innerText=threshInput.value});async function startCamera(){try{stream=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!1}),video.srcObject=stream,showMessage("Câmera ativada. Posicione seu rosto e clique em 'Capturar'.","rgba(0,128,0,0.08)")}catch(e){console.error(e),showMessage("Erro ao abrir a câmera: "+(e.message||e),"rgba(255,80,80,0.2)")}}function captureToCanvas(){return stream?(ctx.drawImage(video,0,0,preview.width,preview.height),showMessage("Foto capturada."),preview.toDataURL("image/png")):(showMessage('Câmera não está ativa. Clique em "Abrir câmera".',"rgba(255,140,0,0.15)"),null)}function imageDataToSmallGray(e){return new Promise((t,a)=>{const r=new Image;r.onload=()=>{const a=document.createElement("canvas");a.width=SMALL_W,a.height=SMALL_H;const n=a.getContext("2d");n.drawImage(r,0,0,SMALL_W,SMALL_H);const i=n.getImageData(0,0,SMALL_W,SMALL_H).data,o=new Float32Array(SMALL_W*SMALL_H);for(let e=0,t=0;e<i.length;e+=4,t++){const a=i[e],r=i[e+1],n=i[e+2];o[t]=.299*a+.587*r+.114*n}t(o)},r.onerror=e=>a(e),r.src=e})}function mse(e,t){let a=0;for(let r=0;r<e.length;r++){const n=e[r]-t[r];a+=n*n}return a/e.length}async function registerReference(){const e=captureToCanvas();if(!e)return;showMessage("Processando referência...","rgba(0,128,0,0.06)");try{const t=await imageDataToSmallGray(e);localStorage.setItem(REF_KEY,JSON.stringify({visual:e,gray:Array.from(t),created:Date.now()})),updateRefStatus(),showMessage("Referência salva com sucesso.","rgba(0,128,0,0.12)")}catch(e){console.error(e),showMessage("Erro ao processar referência.","rgba(255,80,80,0.2)")}}async function verifyFace(){const e=localStorage.getItem(REF_KEY);if(!e)return void showMessage("Nenhuma referência salva. Registre um rosto primeiro.","rgba(255,140,0,0.15)");const t=JSON.parse(e),a=captureToCanvas();if(!a)return;showMessage("Comparando...","rgba(0,128,0,0.04)");try{const[e,r]=await Promise.all([Promise.resolve(new Float32Array(t.gray)),imageDataToSmallGray(a)]),n=mse(e,r),i=Number(threshInput.value);showMessage("Distância (MSE): "+Math.round(n)+" — limiar: "+i),n<=i?(showMessage("✅ Face verificada! Redirecionando...","rgba(0,128,0,0.15)"),stream&&stream.getTracks().forEach(e=>e.stop()),setTimeout(()=>{window.location.href="index3.html"},1e3)):showMessage("❌ Face não corresponde. Tente novamente.","rgba(255,0,0,0.2)")}catch(e){console.error(e),showMessage("Erro na verificação.","rgba(255,80,80,0.2)")}}function clearReference(){localStorage.removeItem(REF_KEY),updateRefStatus(),showMessage("Referência removida.")}btnStart.addEventListener("click",startCamera),btnCapture.addEventListener("click",()=>{captureToCanvas()}),btnRegister.addEventListener("click",registerReference),btnVerify.addEventListener("click",verifyFace),btnClear.addEventListener("click",clearReference),window.addEventListener("beforeunload",()=>{stream&&stream.getTracks().forEach(e=>e.stop())});
  </script>
</body>
</html>
