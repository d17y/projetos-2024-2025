<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificação por SMS - Banco FutureSafe</title>

  <style>
    /* =====================
       Fundo e layout geral
    ===================== */
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #000000, #00FF88);
      font-family: 'Inter', sans-serif;
      color: #fff;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Container principal */
    .container {
      background: rgba(0, 0, 0, 0.25);
      padding: 40px;
      border-radius: 25px;
      box-shadow: 0 0 25px rgba(0, 255, 136, 0.3);
      text-align: center;
      width: 90%;
      max-width: 400px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(0, 255, 136, 0.3);
      animation: fadeIn 1s ease-in-out;
    }

    /* Animação de entrada */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Título */
    h1 {
      font-size: 1.8em;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    /* Descrição */
    .desc {
      color: #aaffdd;
      font-size: 0.9em;
      margin-bottom: 20px;
    }

    /* Input do código */
    #campoCodigo {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      color: #00FFAA;
      font-size: 1.2em;
      text-align: center;
      letter-spacing: 2px;
      outline: none;
      box-shadow: inset 0 0 8px rgba(0, 255, 136, 0.3);
    }

    #campoCodigo::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* Botões */
    .botao {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 30px;
      background: linear-gradient(90deg, #00FF88, #007755);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
      transition: 0.3s;
    }

    .botao:hover {
      transform: scale(1.03);
      box-shadow: 0 0 10px #00FF88;
    }

    /* Botão secundário */
    .botao-sec {
      background: transparent;
      color: #00FFAA;
      border: 2px solid #00FFAA;
      margin-top: 10px;
    }

    .botao-sec:hover {
      background: rgba(0, 255, 170, 0.1);
    }

    /* Mensagens */
    #msg {
      margin-top: 15px;
      font-size: 0.9em;
      color: #fff;
      min-height: 20px;
    }

    /* Timer */
    #timer {
      margin-top: 10px;
      font-size: 0.9em;
      color: #00FFAA;
    }

    /* Fake SMS */
    .fake-sms {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-150%);
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid #00FF88;
      color: #00FFAA;
      padding: 12px 18px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
      transition: transform 0.5s ease;
      max-width: 320px;
      text-align: left;
      font-size: 0.9em;
      backdrop-filter: blur(6px);
    }

    .fake-sms.show {
      transform: translateX(-50%) translateY(0%);
    }

    .fechar-sms {
      float: right;
      cursor: pointer;
      color: #888;
    }

    /* Telefone */
    .telefone {
      font-size: 0.85em;
      color: #aaffdd;
      margin-bottom: 12px;
    }

    /* Botão desativado */
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Verificação por SMS</h1>
    <p class="desc">Enviamos um código para seu número cadastrado.</p>

    <p id="telefoneExib" class="telefone">Número: (carregando...)</p>
    <input id="campoCodigo" type="text" inputmode="numeric" maxlength="6" placeholder="000000">

    <button id="btnVerificar" class="botao">Verificar Código</button>
    <button id="btnReenviar" class="botao botao-sec">Reenviar Código</button>

    <div id="timer"></div>
    <div id="msg"></div>
  </div>

  <div id="fakeSms" class="fake-sms">
    <span class="fechar-sms" id="fecharSms">✕</span>
    <p id="smsTexto"></p>
  </div>

  <script>
    const cpfLogado = localStorage.getItem('ultimo_cpf_logado');
    const usuarios = JSON.parse(localStorage.getItem('banco_usuarios') || '{}');
    const OTP_KEY = 'otp_' + cpfLogado;

    function gerarOTP() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    function salvarOTP(otp, duracao = 30) {
      const exp = Date.now() + duracao * 1000;
      localStorage.setItem(OTP_KEY, JSON.stringify({ otp, exp }));
    }

    function lerOTP() {
      const raw = localStorage.getItem(OTP_KEY);
      if (!raw) return null;
      const data = JSON.parse(raw);
      if (Date.now() > data.exp) {
        localStorage.removeItem(OTP_KEY);
        return null;
      }
      return data.otp;
    }

    function mostrarSmsFake(codigo) {
      const sms = document.getElementById('fakeSms');
      document.getElementById('smsTexto').innerText = "Seu código FutureSafe: " + codigo;
      sms.classList.add('show');
      setTimeout(() => sms.classList.remove('show'), 4000);
    }

    document.getElementById('fecharSms').onclick = () => {
      document.getElementById('fakeSms').classList.remove('show');
    };

    let timerInterval;
    function iniciarTimer(segundos) {
      const timer = document.getElementById('timer');
      const btnVerificar = document.getElementById('btnVerificar');
      clearInterval(timerInterval);
      let restante = segundos;

      timer.textContent = `⏳ Tempo restante: ${restante}s`;
      timerInterval = setInterval(() => {
        restante--;
        timer.textContent = `⏳ Tempo restante: ${restante}s`;
        if (restante <= 0) {
          clearInterval(timerInterval);
          document.getElementById('msg').innerText = "⏰ Código expirou, reenviar para continuar.";
          btnVerificar.disabled = true;
        }
      }, 1000);
    }

    function enviarCodigo() {
      const user = usuarios[cpfLogado];
      const otp = gerarOTP();
      salvarOTP(otp, 30);
      document.getElementById('telefoneExib').innerText = "Número: " + (user?.telefone || "(não informado)");
      mostrarSmsFake(otp);
      iniciarTimer(30);
      document.getElementById('msg').innerText = "Código enviado!";
      document.getElementById('btnVerificar').disabled = false;
    }

    document.getElementById('btnVerificar').addEventListener('click', () => {
      const input = document.getElementById('campoCodigo').value.trim();
      const otpSalvo = lerOTP();

      if (!otpSalvo) {
        document.getElementById('msg').innerText = "⚠️ Código expirado, reenvie.";
        return;
      }
      if (input === otpSalvo) {
        document.getElementById('msg').innerText = "✅ Verificação concluída!";
        localStorage.removeItem(OTP_KEY);
        setTimeout(() => window.location.href = "index2.html", 1000);
      } else {
        document.getElementById('msg').innerText = "❌ Código incorreto.";
      }
    });

    document.getElementById('btnReenviar').addEventListener('click', enviarCodigo);
    document.addEventListener('DOMContentLoaded', enviarCodigo);
  </script>
</body>
</html>
